"""
Simple Mandala System Test

[UNICODE_57FA]Mandala[UNICODE_30B7]
"""

import sys
import os
sys.path.append(os.path.dirname(os.path.dirname(os.path.dirname(__file__))))

from shared.interfaces.mandala_system import MandalaGrid, CellStatus, MandalaSystemInterface


def test_basic_functionality():
    """[UNICODE_57FA]"""
    print("=== Mandala System Basic Test ===")
    
    # 1. [UNICODE_30B0]
    print("1. [UNICODE_30B0]")
    grid = MandalaGrid("test_user_001")
    print(f"   UID: {grid.uid}")
    print(f"   [UNICODE_30B0]: {len(grid.grid)}x{len(grid.grid[0])}")
    print(f"   [UNICODE_4E2D]: {len(grid.core_values)}")
    print(f"   [UNICODE_7DCF]: {grid.total_cells}")
    assert len(grid.grid) == 9
    assert len(grid.grid[0]) == 9
    assert len(grid.core_values) == 9
    print("   [UNICODE_2713] [UNICODE_521D]")
    
    # 2. [UNICODE_4E2D]
    print("\n2. [UNICODE_4E2D]")
    center_cell = grid.grid[4][4]
    print(f"   [UNICODE_4E2D]: {center_cell.quest_title}")
    print(f"   [UNICODE_30B9]: {center_cell.status}")
    assert center_cell.quest_title == "Core Self"
    assert center_cell.status == CellStatus.CORE_VALUE
    print("   [UNICODE_2713] [UNICODE_4E2D]")
    
    # 3. [UNICODE_30BB]
    print("\n3. [UNICODE_30BB]")
    quest_data = {
        "cell_id": "test_cell_001",
        "quest_title": "[UNICODE_671D]",
        "quest_description": "[UNICODE_6BCE]30[UNICODE_5206]",
        "xp_reward": 50,
        "difficulty": 2,
        "therapeutic_focus": "Self-Discipline"
    }
    
    result = grid.unlock_cell(3, 3, quest_data)
    print(f"   [UNICODE_30A2]: {result}")
    print(f"   [UNICODE_30A2]: {grid.unlocked_count}")
    
    cell = grid.grid[3][3]
    print(f"   [UNICODE_30BB]: {cell.quest_title}")
    print(f"   [UNICODE_30BB]: {cell.status}")
    assert result is True
    assert grid.unlocked_count == 1
    assert cell.quest_title == "[UNICODE_671D]"
    print("   [UNICODE_2713] [UNICODE_30BB]")
    
    # 4. [UNICODE_30BB]
    print("\n4. [UNICODE_30BB]")
    complete_result = grid.complete_cell(3, 3)
    print(f"   [UNICODE_5B8C]: {complete_result}")
    
    completed_cell = grid.grid[3][3]
    print(f"   [UNICODE_5B8C]: {completed_cell.status}")
    print(f"   [UNICODE_5B8C]: {completed_cell.completion_time}")
    assert complete_result is True
    assert completed_cell.status == CellStatus.COMPLETED
    print("   [UNICODE_2713] [UNICODE_30BB]")
    
    # 5. [UNICODE_30B7]
    print("\n5. [UNICODE_30B7]")
    serialized = grid.serialize_grid()
    print(f"   [UNICODE_30B7]: {list(serialized.keys())}")
    print(f"   UID: {serialized['uid']}")
    print(f"   [UNICODE_30A2]: {serialized['unlocked_count']}")
    assert serialized["uid"] == "test_user_001"
    assert serialized["unlocked_count"] == 1
    print("   [UNICODE_2713] [UNICODE_30B7]")
    
    # 6. [UNICODE_65E5]
    print("\n6. [UNICODE_65E5]")
    reminder = grid.get_daily_core_value_reminder()
    print(f"   [UNICODE_30EA]: {reminder}")
    assert isinstance(reminder, str)
    assert len(reminder) > 0
    assert "[UNICODE_1F48E]" in reminder
    print("   [UNICODE_2713] [UNICODE_65E5]")
    
    print("\n=== All Tests Passed! ===")


def test_system_interface():
    """[UNICODE_30B7]"""
    print("\n=== Mandala System Interface Test ===")
    
    interface = MandalaSystemInterface()
    
    # 1. [UNICODE_30B0]
    print("1. [UNICODE_30B0]")
    grid1 = interface.get_or_create_grid("user1")
    grid2 = interface.get_or_create_grid("user1")  # [UNICODE_540C]
    grid3 = interface.get_or_create_grid("user2")  # [UNICODE_5225]
    
    print(f"   [UNICODE_30B0]1 UID: {grid1.uid}")
    print(f"   [UNICODE_30B0]2 UID: {grid2.uid}")
    print(f"   [UNICODE_30B0]3 UID: {grid3.uid}")
    print(f"   [UNICODE_30B0]1[UNICODE_3068]2[UNICODE_306F]: {grid1 is grid2}")
    print(f"   [UNICODE_7BA1]: {len(interface.grids)}")
    
    assert grid1 is grid2
    assert grid1 is not grid3
    assert len(interface.grids) == 2
    print("   [UNICODE_2713] [UNICODE_30B0]")
    
    # 2. API[UNICODE_5FDC]
    print("\n2. API[UNICODE_5FDC]")
    api_response = interface.get_grid_api_response("user1")
    print(f"   API[UNICODE_5FDC]: {list(api_response.keys())}")
    print(f"   UID: {api_response['uid']}")
    print(f"   [UNICODE_7DCF]: {api_response['total_cells']}")
    
    assert "uid" in api_response
    assert "grid" in api_response
    assert api_response["uid"] == "user1"
    assert api_response["total_cells"] == 81
    print("   [UNICODE_2713] API[UNICODE_5FDC]")
    
    print("\n=== Interface Tests Passed! ===")


if __name__ == "__main__":
    try:
        test_basic_functionality()
        test_system_interface()
        print("\n[UNICODE_1F389] All Mandala System Tests Completed Successfully! [UNICODE_1F389]")
    except Exception as e:
        print(f"\n[UNICODE_274C] Test Failed: {e}")
        import traceback
        traceback.print_exc()