# 内なる魔物バトルシステム

治療的な魔物との戦闘を通じて、内面の課題に向き合うシステムです。

## 概要

このシステムは、ADHD、不登校、若年NEET層を対象とした治療グレードのゲーミフィケーションアプリケーションの一部として、内面の課題を象徴的な魔物として表現し、実世界の行動を通じて克服していく機能を提供します。

## 主な機能

### 1. 魔物タイプと弱点システム

4種類の治療的魔物が実装されています：

- **先延ばしドラゴン** (HP: 100)
  - テーマ: 行動開始の困難
  - 弱点: ルーティンタスク完了、ポモドーロ使用、小さな一歩行動
  
- **不安の影** (HP: 80)
  - テーマ: 不安と恐怖の克服
  - 弱点: 呼吸法、肯定的確認、マインドフルネス実践
  
- **憂鬱の虚無** (HP: 150)
  - テーマ: 無気力と絶望感の克服
  - 弱点: 社会的つながり、創造的表現、身体活動
  
- **社会恐怖ゴブリン** (HP: 60)
  - テーマ: 社会不安の克服
  - 弱点: 小さな社会的タスク、コミュニケーション練習

### 2. ターンベースバトルシステム

- ユーザーの実世界行動がバトルアクションとして機能
- 魔物の弱点を突くことで効果的なダメージを与える
- 最大10ターンの制限付きバトル

### 3. バトル報酬システム

#### 勝利時報酬
- **コイン**: 基本報酬 + パフォーマンスボーナス
- **XP**: 基本報酬 + パフォーマンスボーナス
- **アイテム**: レアリティに基づく装備・消耗品
- **治療的メッセージ**: 魔物ごとの専用メッセージ

#### 敗北時慰労報酬
- **慰労コイン**: 基本報酬の25%
- **慰労XP**: 基本報酬の25%
- **慰労アイテム**: コモンレアリティアイテム1個
- **サポートメッセージ**: 励ましと次回への示唆

### 4. CBT統合機能

#### 勝利時振り返りプロンプト
- 効果的だった行動の振り返り
- 認知パターンの気づき促進
- 今後の行動計画立案支援

#### 敗北時振り返りプロンプト
- 挑戦したことの価値確認
- 小さな進歩の認識
- 自己受容の促進

### 5. アイテムシステム

#### レアリティ分類
- **Common** (50%): 基本的な効果
- **Uncommon** (30%): 中程度の効果
- **Rare** (15%): 高い効果
- **Epic** (4%): 非常に高い効果
- **Legendary** (1%): 最高の効果

#### 治療的効果
各アイテムは以下の能力値にボーナスを提供：
- **集中力** (focus): タスクへの集中力向上
- **回復力** (resilience): ストレス耐性向上
- **やる気** (motivation): 行動意欲向上
- **社会性** (social): 社会的スキル向上
- **創造性** (creativity): 創造的思考力向上
- **知恵** (wisdom): 学習効率向上

## API使用例

### バトル開始
```python
from main import InnerDemonBattle, DemonType

battle_system = InnerDemonBattle()

# バトル開始
result = battle_system.initiate_battle(
    user_id="user123",
    demon_type=DemonType.PROCRASTINATION_DRAGON,
    user_recent_actions=["routine_task_completion", "pomodoro_usage"]
)
```

### バトル継続
```python
# 追加アクションでバトル継続
result = battle_system.continue_battle(
    user_id="user123",
    new_actions=["small_step_action", "deadline_adherence"]
)
```

### バトル状況確認
```python
# 現在のバトル状況取得
status = battle_system.get_battle_status("user123")
```

## テスト

### 単体テスト実行
```bash
python -m pytest test_demon_battle.py -v
```

### 統合テスト実行
```bash
python -m pytest test_battle_rewards_integration.py -v
```

### 動作確認
```bash
python main.py
python battle_rewards.py
```

## ファイル構成

- `main.py`: メインバトルシステム
- `battle_rewards.py`: 報酬システムとCBT統合
- `test_demon_battle.py`: 単体テスト
- `test_battle_rewards_integration.py`: 統合テスト
- `README.md`: このファイル

## 治療的配慮

このシステムは以下の治療的原則に基づいて設計されています：

1. **段階的暴露**: 小さな挑戦から始めて徐々に難易度を上げる
2. **認知再構成**: CBT技法を用いた思考パターンの見直し
3. **行動活性化**: 具体的な行動を通じた気分改善
4. **自己効力感向上**: 成功体験の積み重ねによる自信構築
5. **社会的支援**: つながりと共感を重視したメッセージング

## 今後の拡張予定

- 季節イベント魔物の追加
- 協力バトル機能
- 魔物図鑑システム
- バトル履歴とプログレス追跡
- カスタム魔物作成機能